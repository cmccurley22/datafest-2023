---
title: "kate-exploring"
output: github_document
date: "2023-04-14"
---

```{r setup, include=FALSE}
library(tidyverse)
# knitr options
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r read-data}
df_attorneys <- read_csv("./data/attorneys.csv")
df_attorneytimeentries <- read_csv("./data/attorneytimeentries.csv")
df_categories <- read_csv("./data/categories.csv")
df_clients <- read_csv("./data/clients.csv")
df_questionposts <- read_csv("./data/questionposts.csv")
df_questions <- read_csv("./data/questions.csv")
df_statesites <- read_csv("./data/statesites.csv")
df_subcategories <- read_csv("./data/subcategories.csv")

```

```{r}
df_zip <- read_csv("./uszips.csv") %>%
  rename(PostalCode = zip)
df_zip
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
df_attorneytimeentries %>%
  ggplot(aes(y = StateAbbr, x = Hours)) +
  geom_point()
```

```{r}
df_attorney_data <-
  merge(df_attorneys, df_attorneytimeentries, by = c("AttorneyUno", "StateAbbr")) %>%
  subset(select = -c(Id.x, Id.y, CreatedUtc, EnteredOnUtc, TimeEntryUno))


df_attorney_data
```

```{r}
df_question_data <-
  merge(df_questions, df_questionposts, by = c("QuestionUno", "StateAbbr")) %>%
  subset(select = -c(Id.x, Id.y, CategoryUno, SubcategoryUno, TakenOnUtc, ClosedOnUtc, LegalDeadline, CreatedUtc))

df_question_data <-
  df_question_data %>%
  rename(ClientUno = AskedByClientUno)

df_question_data <-
  df_question_data %>%
  rename(AttorneyUno = ClosedByAttorneyUno)

df_question_data
```

```{r}
df_categories_data <-
  merge(df_categories, df_subcategories, by = c("CategoryUno", "StateAbbr")) %>%
  subset(select = -c(Id.x, Id.y))


df_categories_data
```

```{r}
df_client_state_data <-
  merge(df_clients, df_statesites, by = c("StateAbbr", "StateName")) %>%
  subset(select = -c(Id.x, Id.y, CreatedUtc))

df_client_state_data
```

```{r}


df_client_state_data <-
  df_client_state_data %>%
  rename(ClientCreatedUtc = CreatedUtc)
```

```{r}
big_data_1 <-
  merge(df_question_data, df_client_state_data, by = c("ClientUno", "StateAbbr")) %>%
  subset(select = -c(ClientUno, QuestionUno, StateName))

big_data_1
```

```{r}
df_zip_tz <-
  left_join(big_data_1, df_zip, by=("PostalCode"))
df_zip_tz

df_sum_tz <-
  df_zip_tz %>% 
  summarise(PostalCode, timezone)
df_sum_tz

df_sum_tz_unique = df_sum_tz[!duplicated(df_sum_tz), ]
df_sum_tz_unique
```

```{r}
library(lubridate)
date = force_tzs(df_zip_tz$AskedOnUtc, tzones = "UTC")
strftime(date, format = "%Y/%m/%d %H:%M:%S", tz = "America/Chicago" )
```

```{r}
ALL_DATA <-
  merge(big_data_1, df_attorney_data, by = c("AttorneyUno", "StateAbbr"))

ALL_DATA
```
